"use strict";function draw(a,b,c){var d=d3.scale.ordinal().range(["#51e566","#f9e75a","#f25170","#51aef3","#fc8c5a"]),e=a.data,f=Math.min(a.width,200),g=d3.select(b[0]).append("svg"),h=d3.layout.pie().sort(null);console.log(a.data),arc.outerRadius(f/2*.8).innerRadius(f/2*1),h.value(function(a){return+a.value}),g.attr({width:a.width,height:200});var i=g.append("g").attr("transform","translate("+a.width/2+",100)"),j=i.selectAll("path").data(h(e)).enter().append("path").attr("fill-opacity",1).attr("fill",function(a,b){return d(b)}).each(function(a){return this._current=a});console.log(a.data+"scopeData"),a.$watch("data",function(b,c){console.log(b);j.data(h(a.data)),j.transition().duration(750).attrTween("d",arcTween)},!0)}function arcTween(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return arc(b(a))}}var app=angular.module("app",["ngRoute","nvd3","ngMaterial"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/asset/",{templateUrl:"../../assets/templates/assetManagment/assetDetail.html",controller:"assetDetailController"}).when("/dashboard/:dashboardSelect",{templateUrl:"../../assets/templates/common/dashboard.html",controller:"dashboardController"}).otherwise({redirectTo:"/dashboard/analytics"}),c.defaults.useXDomain=!0}]);app.controller("analyticsController",["$routeParams","$scope","$rootScope","$window","$location","locationMapService","getDataService","analyticsMapService",function(a,b,c,d,e,f,g,h){function i(a){function c(a){var b=0;if(document.getElementById("overallEffDiv")&&(b=document.getElementById("overallEffDiv").clientWidth),b>0){radialProgress(document.getElementById("overallEffDiv")).diameter(b).value(a).render()}}var e=0;h.getOverallEffData(a).then(function(a){e=a.data.overallEfficeincy,j=d3.select(document.getElementById("overallEffDiv")),c(e)}),h.getPerformanceData(a).then(function(a){console.log(a.data.performanceMetrics),b.performanceMetrics=a.data.performanceMetrics,b.filteredPerformanceMetrics=[],b.perfMetricChartData=[],b.totalPump=0,angular.forEach(b.performanceMetrics,function(a){b.totalPump=b.totalPump+a.units}),angular.forEach(b.performanceMetrics,function(a){var c={label:a.label,percentage:Number((a.units/b.totalPump*100).toFixed(1)),units:a.units};b.filteredPerformanceMetrics.push(c)}),angular.forEach(b.performanceMetrics,function(a){var c={label:a.label,value:a.units/b.totalPump*100};b.perfMetricChartData.push(c)}),b.callMetricDirective=!0}),angular.element(d).bind("resize",function(){document.getElementById("overallEffDiv")&&(document.getElementById("overallEffDiv").innerHTML=""),c(e),b.$digest()})}var j=d3.select(document.getElementById("overallEffDiv"));c.activePage="analytics",b.performanceMetrics=[],b.totalPump=0,b.callMetricDirective=!1,c.$on("callJSONservice",function(){console.log("$rootScope.pumpType"+c.pumpType),i(c.pumpType)}),i(c.pumpType?c.pumpType:""),b.redirectToAsset=function(a){"Performance Optimally"==a?c.assetFilter={machineStatus:"Performing_Optimally"}:"Failure Predicted"==a?c.assetFilter={machineStatus:"Predicting_Failure"}:"Failure"==a?c.assetFilter={machineStatus:"Failure"}:"Undergoing Maintanence"==a?c.assetFilter={machineStatus:"Undergoing_Maintanence"}:"No Data"==a&&(c.assetFilter={machineStatus:"NO_DATA"}),location.replace("/#/dashboard/assetsearch")},b.setMetric=function(a){b.selectedLabel=a},b.selectedMetricCheck=function(a){return a==b.selectedLabel}}]),app.controller("analyticsMapController",["$routeParams","$scope","$rootScope","locationMapService","getDataService","analyticsMapService",function(a,b,c,d,e,f){b.selectedTab="analyticsView",c.activePage="analytics",b.performanceMetrics=[],b.$watch("selection",function(a){c.pumpType=a,c.$emit("callJSONservice",{})}),b.selectTab=function(a){console.log(a+"tabSelected"),b.selectedTab=a},b.selectedTabCheck=function(a){if(a==b.selectedTab)return!0},f.getPumpTypeData().then(function(a){b.pumpTypeList=a.data.pumpType,b.selection="",console.log("$scope.pumpTypeList"),console.log(b.pumpTypeList)})}]),app.controller("mapLocationController",["$routeParams","$scope","$rootScope","locationMapService","getDataService","$timeout","$interval","analyticsMapService",function(a,b,c,d,e,f,g,h){b.location=[],c.activePage="analytics",b.mapFilterList={PERFORMING_OPTIMALLY:!1,FAILURE:!1,PREDICTING_FAILURE:!1,MAINTENANCE:!1,NO_DATA:!1};!function(){h.getMapLocationData().then(function(a){b.location=a,d.createOutdoorMap(b.location)&&d.createMachineMarkers(b.location,b.mapFilterList)}),b.all=function(){b.mapFilterList.FAILURE=!1,b.mapFilterList.PREDICTING_FAILURE=!1,b.mapFilterList.UNDERGOING_MAINTENANCE=!1,b.mapFilterList.PERFORMING_OPTIMALLY=!1,b.mapFilterList.NO_DATA=!1,d.createMachineMarkers(b.location,b.mapFilterList)},b.performingOptimally=function(){b.mapFilterList.PERFORMING_OPTIMALLY=!b.mapFilterList.PERFORMING_OPTIMALLY,d.createMachineMarkers(b.location,b.mapFilterList)},b.failure=function(){b.mapFilterList.FAILURE=!b.mapFilterList.FAILURE,d.createMachineMarkers(b.location,b.mapFilterList)},b.failurePred=function(){b.mapFilterList.PREDICTING_FAILURE=!b.mapFilterList.PREDICTING_FAILURE,d.createMachineMarkers(b.location,b.mapFilterList)},b.underMaintainance=function(){b.mapFilterList.UNDERGOING_MAINTENANCE=!b.mapFilterList.UNDERGOING_MAINTENANCE,d.createMachineMarkers(b.location,b.mapFilterList)},b.noData=function(){b.mapFilterList.NO_DATA=!b.mapFilterList.NO_DATA,d.createMachineMarkers(b.location,b.mapFilterList)}}(),b.selectedFilterCheck=function(a){return b.selectedMapFilter==a}}]),app.controller("assetDetailController",["$routeParams","$scope","$rootScope","locationMapService","getDataService","$timeout","$interval","assetManagementService",function(a,b,c,d,e,f,g,h){function i(a,b){var c={chart:{type:"solidgauge"},title:null,pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:"#22262a",innerRadius:"80%",outerRadius:"100%",shape:"arc",borderColor:"#22262a"}},tooltip:{enabled:!1},yAxis:{stops:[[1,a]],lineWidth:0,minorTickInterval:null,tickAmount:0,title:{y:-16},labels:{y:"two"}},plotOptions:{solidgauge:{innerRadius:"80%",dataLabels:{y:5,borderWidth:0,useHTML:!0}}}};Highcharts.chart("container-speed",Highcharts.merge(c,{yAxis:{min:-100,max:798,title:{text:""}},credits:{enabled:!1},series:[{name:"Speed",data:[b],dataLabels:{format:'<div style="text-align:center"><span style="font-size:32px;color:#fff">{y}</span><br/><span style="font-size:16px;color:silver">DAYS</span></div>'},tooltip:{valueSuffix:" Days"}}]}))}function j(a){radialProgress(document.getElementById("overallEffDiv")).diameter(225).value(a).render()}function k(a){Highcharts.stockChart("energyConsumption",{chart:{type:"line",zoomType:"y"},legend:{enabled:!0,align:"right",verticalAlign:"top",floating:!0,itemStyle:{color:"#f4f4f4"},itemHoverStyle:{color:"#FFF"}},rangeSelector:{enabled:!1},plotOptions:{series:{showInNavigator:!0}},navigator:{series:{type:"line",color:"#b9dc5b",lineColor:"#b9dc5b",smoothed:!1}},title:{text:""},xAxis:{type:"datetime"},yAxis:{opposite:!1,gridLineWidth:0,tickLength:5,tickWidth:1,tickPosition:"outside",labels:{align:"right",x:-10,y:5},lineWidth:1},credits:{enabled:!1},series:[{name:"AAPL",color:"#b9dc5b",data:a,tooltip:{valueDecimals:2},showInNavigator:!0}]})}function l(a,b){Highcharts.stockChart("dischargeAndSuction",{chart:{type:"line",zoomType:"y"},legend:{enabled:!0,align:"right",verticalAlign:"top",floating:!0,itemStyle:{color:"#f4f4f4"},itemHoverStyle:{color:"#FFF"}},rangeSelector:{enabled:!1},plotOptions:{series:{showInNavigator:!0}},navigator:{series:{type:"line",color:"#f77163",lineColor:"#f77163",smoothed:!1}},title:{text:""},xAxis:{type:"datetime"},yAxis:{opposite:!1,gridLineWidth:0,tickLength:5,tickWidth:1,tickPosition:"outside",labels:{align:"right",x:-10,y:5},lineWidth:1},credits:{enabled:!1},series:[{name:"Discharge",color:"#f77163",data:a,tooltip:{valueDecimals:2},showInNavigator:!0},{name:"Suction",color:"#eaa156",data:b,tooltip:{valueDecimals:2},showInNavigator:!0}]})}b.sensorData=[{sensorType:"Thermal Sensor",sensorStatus:"optimal_performance"},{sensorType:"Pt100",sensorStatus:"optimal_performance"},{sensorType:"QC250",sensorStatus:"no_data"},{sensorType:"FLS100",sensorStatus:"optimal_performance"},{sensorType:"PTC Thermistors",sensorStatus:"no_data"},{sensorType:"CLS",sensorStatus:"optimal_performance"},{sensorType:"VLS 100",sensorStatus:"optimal_performance"}],b.stepProgressData=[{date:"1 Feb",info:"4 Issue Fixed"},{date:"12 Feb",info:"24 Issue Fixed"},{date:"13 Feb",info:"1 Issue Fixed"},{date:"15 Feb",info:"1 Issue Fixed"},{date:"27 Feb",info:"2 Issue Fixed"}],c.activePage="assetManagement",c.assetUri||location.replace("/#/dashboard/assetsearch"),b.hourData=[{label:"1 Hour",value:"1h"},{label:"4 Hour",value:"4h"},{label:"8 Hour",value:"8h"}],b.selectHour="1h",b.$watch("selectHour",function(a){console.log("newval"+a)}),b.graphselect="false",b.$watch("graphselect",function(a){console.log(a),1==a?(h.getStoredDischargeGraphData().then(function(a){b.dischargeData=a["Discharge.pump11"],b.suctionData=a["Ingest.pump11"],l(b.dischargeData,b.suctionData)}),h.getStoredEnergyGraphData().then(function(a){b.energyConsumption=a["EnergyConsumption.pump11"],k(b.energyConsumption)})):(h.getPredixDischargeGraphData().then(function(a){b.dischargeData=a["Discharge.pump9"],b.suctionData=a["Ingest.pump9"],l(b.dischargeData,b.suctionData)}),h.getPredixEnergyGraphData().then(function(a){b.energyConsumption=a["EnergyConsumption.pump9"],k(b.energyConsumption)}))});var m=0;h.getPredixDischargeGraphData().then(function(a){b.dischargeData=a["Discharge.pump9"],b.suctionData=a["Ingest.pump9"],l(b.dischargeData,b.suctionData)}),h.getPredixEnergyGraphData().then(function(a){b.energyConsumption=a["EnergyConsumption.pump9"],console.log(b.energyConsumption),k(b.energyConsumption)}),h.getAssetInfoData(c.assetUri).then(function(a){b.assetInfo=a,m=b.assetInfo.analyticAttributes.machineEfficiencyLevel,j(m),b.assetLocation={lat:b.assetInfo.latitude,lon:b.assetInfo.longitude,status:b.assetInfo.analyticAttributes.machineStatus};b.assetInfo.status;d.createOutdoorMap(b.assetLocation)&&d.createAssetMachineMarkers(b.assetLocation)}),b.runAnalytics=function(){console.log(c.assetUri);var a,e;h.getAssetInfoData(c.assetUri).then(function(c){b.assetInfo=c,m=b.assetInfo.analyticAttributes.machineEfficiencyLevel,j(m),b.assetLocation={lat:b.assetInfo.latitude,lon:b.assetInfo.longitude,status:b.assetInfo.analyticAttributes.machineStatus};b.assetInfo.status;d.createOutdoorMap(b.assetLocation)&&d.createAssetMachineMarkers(b.assetLocation),a=b.assetInfo.analyticAttributes.machineStatus}).then(function(d){console.log(d+"resp2"),console.log(a+"machineStatusCode"),"PREDICTING_FAILURE"==a?(e="#f9e75a",b.analyticsMachineStatusData="Predicting Failure"):"FAILED"==a?(e="#f25170",b.analyticsMachineStatusData="Failure"):"UNDERGOING_MAINTENANCE"==a?(e="#51aef3",b.analyticsMachineStatusData="Undergoing Maintenance"):"PERFORMING_OPTIMALLY"==a?(e="#51e566",b.analyticsMachineStatusData="Performing Optimally"):(e="#fc8c5a",b.analyticsMachineStatusData="No Data"),h.getCavitationData(c.assetUri).then(function(a){var b=parseInt(a.CavitationFailureNumber);i(e,b)})})},i("#fc8c5a",-100);k(),l()}]),app.controller("assetManagementController",["$routeParams","$scope","$rootScope","assetManagementService",function(a,b,c,d){c.activePage="assetManagement",b.currentPage=0,b.pageSize=10,b.numberOfPages,b.filteredAssetList=[],b.selectedManufacturerFilterList=[],b.selectedModelNameFilterList=[],b.activeManufacturerFilter=!0,b.activeModelNameFilter=!1,b.manufacturerList=[],b.modelNameList=[],b.useFilterList=!1,Array.prototype.removeValue=function(a,b){var c=$.map(this,function(c,d){return c[a]===b?null:c});this.length=0,this.push.apply(this,c)},Array.prototype.removeCustomValue=function(a,b,c,d){var e=$.map(this,function(e,f){return e[a]===b&&e[c]===d?null:e});this.length=0,this.push.apply(this,e)},Array.prototype.checkObjectInArray=function(a,b){if(!this||0===this.length)return!1;var c=!1;return angular.forEach(this,function(d){d[a]==b&&(c=!0)}),c},b.setPage=function(a){b.currentPage=a<0?0:a},b.resetFilter=function(){b.filterActive=!1,b.activeManufacturerFilter=!1,b.activeModelNameFilter=!1,b.selectedManufacturerFilterList=[],b.selectedModelNameFilterList=[],b.filteredAssetList=c.assetsList},b.toggleKeyFilter=function(a){"manufacturer"==a?(b.activeManufacturerFilter=!b.activeManufacturerFilter,b.activeModelNameFilter=!1,b.selectedManufacturerFilterList=b.activeManufacturerFilter?b.selectedManufacturerFilterList:[],b.filteredAssetList=b.activeManufacturerFilter?b.filteredAssetList:c.assetsList):"modelName"==a&&(b.activeModelNameFilter=!b.activeModelNameFilter,b.activeManufacturerFilter=!1,b.selectedModelNameFilterList=b.activeModelNameFilter?b.selectedModelNameFilterList:[],b.filteredAssetList=b.activeModelNameFilter?b.filteredAssetList:c.assetsList)},b.checkActiveFilterForValue=function(a,c){return!("manufacturer"!=a||!b.selectedManufacturerFilterList.checkObjectInArray(a,c))||!("modelName"!=a||!b.selectedModelNameFilterList.checkObjectInArray(a,c))},b.filterAssetList=function(a,d,e){0==b.selectedManufacturerFilterList.length&&0==b.selectedModelNameFilterList.length?("manufacturer"==a?angular.forEach(c.assetsList,function(c){c[a]==d&&b.selectedManufacturerFilterList.push(c)}):"modelName"==a&&angular.forEach(c.assetsList,function(c){c[a]==d&&b.selectedModelNameFilterList.push(c)}),b.filteredAssetList=[],angular.forEach(c.assetsList,function(c){c[a]==d&&b.filteredAssetList.push(c)})):"manufacturer"==a?b.selectedManufacturerFilterList.checkObjectInArray(a,d)?(angular.forEach(b.selectedManufacturerFilterList,function(c){c[a]==d&&(b.selectedModelNameFilterList.checkObjectInArray("modelName",c.modelName)||b.filteredAssetList.removeCustomValue(a,d,"modelName",c.modelName))}),b.selectedManufacturerFilterList.removeValue(a,d)):(angular.forEach(c.assetsList,function(c){c[a]==d&&b.selectedManufacturerFilterList.push(c)}),angular.forEach(c.assetsList,function(c){c[a]==d&&b.filteredAssetList.indexOf(c)<0&&b.filteredAssetList.push(c)})):"modelName"==a&&(b.selectedModelNameFilterList.checkObjectInArray(a,d)?(angular.forEach(b.selectedModelNameFilterList,function(c){c[a]==d&&(b.selectedModelNameFilterList.checkObjectInArray("manufacturer",c.manufacturer)||b.filteredAssetList.removeCustomValue(a,d,"manufacturer",c.manufacturer))}),b.selectedModelNameFilterList.removeValue(a,d)):(angular.forEach(c.assetsList,function(c){c[a]==d&&b.selectedModelNameFilterList.push(c)}),angular.forEach(c.assetsList,function(c){c[a]==d&&b.filteredAssetList.indexOf(c)<0&&b.filteredAssetList.push(c)}))),0==b.selectedManufacturerFilterList.length&&0==b.selectedModelNameFilterList.length&&(b.filteredAssetList=c.assetsList),b.numberOfPages=Math.ceil(b.filteredAssetList.length/b.pageSize)},b.prepareAssetsList=function(){b.filteredAssetList=[],c.assetsList||d.getAssetsList().then(function(a){c.assetsList=a}),c.assetFilter&&c.assetFilter.product&&""!=c.assetFilter.product?(b.useFilterList=!0,angular.forEach(c.assetsList,function(a){a.serialNumber==c.assetFilter.product&&b.filteredAssetList.push(a)})):c.assetFilter&&c.assetFilter.machineStatus&&""!=c.assetFilter.machineStatus?(b.useFilterList=!0,angular.forEach(c.assetsList,function(a){a.analyticAttributes.machineStatus.toUpperCase()==c.assetFilter.machineStatus.toUpperCase()&&b.filteredAssetList.push(a)})):(b.useFilterList=!1,b.filteredAssetList=c.assetsList),(b.manufacturerList.length<=0||b.modelNameList.length<=0)&&angular.forEach(c.assetsList,function(a){var c=!1,d=!1;angular.forEach(b.manufacturerList,function(b){b.manufacturer===a.manufacturer&&(c=!0)}),angular.forEach(b.modelNameList,function(b){b.modelName===a.modelName&&(d=!0)}),c||b.manufacturerList.push(a),d||b.modelNameList.push(a)})},b.$watch(function(a){return a.filteredAssetList},function(){b.filteredAssetList&&(b.numberOfPages=Math.ceil(b.filteredAssetList.length/b.pageSize))}),b.$watch(function(a){return a.assetFilter},function(){c.assetFilter&&b.prepareAssetsList()}),b.prepareAssetsList()}]),app.filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}),app.filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;c<b;c++)a.push(c);return a}}),app.controller("dashboardController",["$routeParams","$scope","$rootScope","$location","locationMapService","assetManagementService","$timeout","$interval",function(a,b,c,d,e,f,g,h){b.notificationDashboard=!1,b.analyticsDashboard=!1,b.assetManagment=!0,b.assetDetailDashboard=!1,"notification"==a.dashboardSelect?(b.notificationDashboard=!0,b.analyticsDashboard=!1,b.assetManagment=!1,b.assetDetailDashboard=!1):"assetsearch"==a.dashboardSelect?(b.notificationDashboard=!1,b.analyticsDashboard=!1,b.assetManagment=!0,b.assetDetailDashboard=!1):"assetdetail"==a.dashboardSelect?(b.notificationDashboard=!1,b.analyticsDashboard=!1,b.assetManagment=!1,b.assetDetailDashboard=!0):(b.notificationDashboard=!1,b.analyticsDashboard=!0,b.assetManagment=!1,b.assetDetailDashboard=!1),b.assetDetail=function(a){c.assetUri=a,location.replace("/#/dashboard/assetdetail")},b.goBack=function(){location.replace("/#/dashboard/assetsearch")},c.querySearch=function(a){var d,e=a?c.productListDropDown.filter(b.createFilterFor(a)):c.productListDropDown;return c.simulateQuery?(d=$q.defer(),g(function(){d.resolve(e)},1e3*Math.random(),!1),d.promise):e},c.selectedItemChange=function(a){c.assetFilter=a?{product:a.display}:{},angular.element(".md-scroll-mask").remove(),angular.element("body").attr("style",""),location.replace("/#/dashboard/assetsearch")},b.loadAll=function(){if(angular.forEach(c.assetsList,function(a){c.productList&&a.serialNumber?c.productList+=", "+a.serialNumber:a.serialNumber&&(c.productList=a.serialNumber)}),c.productList)return c.productList.split(/, +/g).map(function(a){return{value:a.toLowerCase(),display:a}})},b.createFilterFor=function(a){var b=angular.lowercase(a);return function(a){return 0===a.value.indexOf(b)}},b.getAssetsList=function(a){(!c.assetsList||c.assetsList.length<0)&&f.getAssetsList().then(function(a){c.assetsList=a,c.productListDropDown=b.loadAll()})},b.getAssetsList()}]),app.controller("sidebarController",["$routeParams","$scope","$rootScope",function(a,b,c){b.sideBarExpanded=!1}]),app.controller("notificationDashboardController",["$routeParams","$scope","$rootScope","locationMapService","getDataService","notificationDashboardService","$interval",function(a,b,c,d,e,f,g){f.getNotificationData().then(function(a){b.notificationData=a.data.notificationData}),g(function(){f.getNotificationData().then(function(a){b.notificationData=a.data.notificationData})},15e12),b.orderByDate=function(a){var b=a.dateStamp.split("/");return-parseInt(b[2]+b[1]+b[0])},b.orderByTime=function(a){var b,c=a.messageTime.split(":"),d=c[1].split(" ");return console.log("part1 "+c[0]+"part2 "+d[0]+"part3 "+d[1]),b="AM"==d[1]?1e5:2e5,-(b=b+parseInt(c[0])+parseInt(d[0]))},b.notificationFilterList={FAILURE:!1,PREDICTING_FAILURE:!1,UNDERGOING_MAINTENANCE:!1,NO_DATA:!1},b.all=function(){b.notificationFilterList.FAILURE=!1,b.notificationFilterList.PREDICTING_FAILURE=!1,b.notificationFilterList.UNDERGOING_MAINTENANCE=!1,b.notificationFilterList.NO_DATA=!1},b.failure=function(){b.notificationFilterList.FAILURE=!b.notificationFilterList.FAILURE},b.failurePred=function(){b.notificationFilterList.PREDICTING_FAILURE=!b.notificationFilterList.PREDICTING_FAILURE},b.UnderMaintainance=function(){b.notificationFilterList.UNDERGOING_MAINTENANCE=!b.notificationFilterList.UNDERGOING_MAINTENANCE},b.noData=function(){b.notificationFilterList.NO_DATA=!b.notificationFilterList.NO_DATA}}]),app.filter("notificationFilter",function(){return function(a,b){var c={filterCheck:b,out:[]};return(b.FAILURE||b.PREDICTING_FAILURE||b.NO_DATA||b.UNDERGOING_MAINTENANCE)===!1?c.out=a:angular.forEach(a,function(a,b){this.filterCheck[a.machineStatus]===!0&&this.out.push(a)},c),c.out}}),app.directive("analyticCard",function(){function a(a,b,c){}return{link:a,restrict:"E",scope:{data:"="}}});var arc=d3.svg.arc();app.directive("metricChart",["$window",function(a){function b(b,c,d){document.getElementById("metricChart")&&(b.width=document.getElementById("metricChart").clientWidth),b.width>0&&draw(b,c,d),angular.element(a).bind("resize",function(){d3.select("#metricChart").select("svg").remove(),document.getElementById("metricChart")&&(b.width=document.getElementById("metricChart").clientWidth),b.width>0&&draw(b,c,d),b.$digest()})}return{link:b,restrict:"E",scope:{data:"="}}}]);var arc=d3.svg.arc();app.directive("pumpEfficiencyDirective",["$window",function(a){function b(b,c,d){var e=0;if(c[0]&&(e=c[0].clientWidth),e>0){radialProgress(c[0]).diameter(e).value(d.pumpefficiencyval).render()}angular.element(a).bind("resize",function(){c[0]&&(c[0].innerHTML="");var a=0;if(c[0]&&(a=c[0].clientWidth),a>0){radialProgress(c[0]).diameter(a).value(d.pumpefficiencyval).render()}})}return{link:b,restrict:"A"}}]),app.directive("selectPump",function(a){function b(b,c,d){function e(){o.width(l.outerWidth()),o.height(l.outerHeight())}function f(){m.children().filter(".preselected").removeClass("preselected"),m.find("div").eq(p).addClass("preselected"),console.log(p)}function g(){console.log(b.ops.length),p=(p+1)%b.ops.length,f()}function h(){console.log(b.ops.length),p=(p-1)%b.ops.length,f()}function i(){b.selectOpt(b.ops[p]),b.$apply()}console.log("mySelect directive");for(var j in b.ops)b.ops[j].value==b.selection&&(b.selectedOpt=b.ops[j]);var k=!1;/ipad|iphone|android/gi.test(a.navigator.userAgent)&&(k=!0),b.selectOpt=function(a){b.selection=a.value,m.removeClass("active"),n.removeClass("active")},b.$watch("selection",function(a){for(var c in b.ops)b.ops[c].value==a&&(b.selectedOpt=b.ops[c]);console.log("scope.selectedOpt")});var l=c.find(".my-select-label"),m=c.find(".my-select-ops"),n=c.find(".my-select-backdrop"),o=c.find("select");l.on("click",function(){e(),m.toggleClass("active"),n.toggleClass("active")}),n.on("click",function(){m.removeClass("active"),n.removeClass("active")}),c.on("keydown",function(a){switch(a.which){case 37:case 38:h();break;case 39:case 40:g();break;case 13:i()}}),e(),$(a).on("resize",function(){e()}),k&&o.addClass("active");var p=0;f()}return{link:b,scope:{ops:"=selectPump",selection:"=selection"},template:'<div class="my-select-label" tabindex="0" title="{{selectedOpt.label}}"><div class="my-select-label-text">{{selectedOpt.label}}</div><span class="my-select-caret"><svg viewBox="0 0 100 60"><polyline points="10,10 50,50 90,10" style="fill:none;stroke:#f3f3f3;stroke-width:8;stroke-linecap:round;"/></svg></span></div><div class="my-select-backdrop"></div><div class="my-select-ops"><div ng-repeat="o in ops" ng-click="selectOpt(o)">{{o.label}}</div></div><select ng-options="opt.value as opt.label for opt in ops" ng-model="selection"></select>'}}),app.service("analyticsMapService",function(a,b){function c(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getAssetType"}).then(h,g)}function d(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getAssetData/machine"}).then(h,g)}function e(b){var c=a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getOverallEfficiency/"+b});return console.log(c),c.then(h,g)}function f(b){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getPerformanceMetric/"+b}).then(h,g)}function g(a){var c="";return angular.isObject(a.data)&&a.data.message||(c=b.reject("An unknown error occurred.")),0===c.length&&(c=b.reject(a.data.message)),c}function h(a){return console.log("response"+a),console.log(a),a.data}return{getPumpTypeData:c,getMapLocationData:d,getOverallEffData:e,getPerformanceData:f}}),app.service("assetManagementService",function(a,b){function c(b,c){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/analytics"+b+"?timeDuration="+c}).then(l,k)}function d(b){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/predictedCavitationFailure"+b}).then(l,k)}function e(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getDischargePressureGraph/machine/1"}).then(l,k)}function f(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getEnergyConsumptionGraph/machine/1"}).then(l,k)}function g(){return a({method:"get",url:"../../assets/data/assetStoredGraphData.json"}).then(l,k)}function h(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getEnergyConsumptionGraph/machine/3"}).then(l,k)}function i(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getAssetData/machine"}).then(l,k)}function j(b){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getAssetDataByAssetId"+b}).then(l,k)}function k(a){var c="";return angular.isObject(a.data)&&a.data.message||(c=b.reject("An unknown error occurred.")),0===c.length&&(c=b.reject(a.data.message)),c}function l(a){return console.log("response"+a),console.log(a),a.data}return{getPredixDischargeGraphData:e,getPredixEnergyGraphData:f,getStoredDischargeGraphData:g,getStoredEnergyGraphData:h,getAssetInfoData:j,getAssetsList:i,getAnalyticsData:c,getCavitationData:d}}),app.service("getDataService",function(a,b){function c(b){return a({method:"get",url:b}).then(f,e)}function d(a){}function e(a){var c="";return angular.isObject(a.data)&&a.data.message||(c=b.reject("An unknown error occurred.")),0===c.length&&(c=b.reject(a.data.message)),c}function f(a){return console.log("response"+a),console.log(a),a.data}return{getGetData:c,getPostData:d}}),app.service("locationMapService",function(a,b){function c(a){return h=d(a)}function d(a){return h=new google.maps.Map(document.getElementById("outdoorMap"),{scrollwheel:!1,center:{lat:46.759197,lng:17.701408},zoom:3,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{elementType:"geometry",stylers:[{color:"#4e575f"}]},{elementType:"labels.text.stroke",stylers:[{color:"#000"}]},{elementType:"labels.text.fill",stylers:[{color:"#000"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"transparent"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"transparent"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#434b52"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#434b52"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#434b52"}]}]})}function e(a,b){h.getCenter();console.log(b);var c,d,e;console.log(i.length+"main"),f(null);var g={filter:b,out:[]};(b.FAILURE||b.PREDICTING_FAILURE||b.UNDERGOING_MAINTENANCE||b.NO_DATA||b.PERFORMING_OPTIMALLY)===!1?g.out=a:angular.forEach(a,function(a,b){this.filter[a.analyticAttributes.machineStatus]===!0&&this.out.push(a)},g),e=g.out,console.log(e),angular.forEach(e,function(a,b){function e(a,b){var c,d=f(a.getCenter()),e=f(b.getPosition()),g="";return g+=e.y>d.y?"b":"t",g+=e.x<d.x?"l":"r","tr"==g?c=new google.maps.Size(-70,315):"tl"==g?c=new google.maps.Size(100,315):"br"==g?c=new google.maps.Size(-70,20):"bl"==g&&(c=new google.maps.Size(70,20)),c}function f(a){return h.getProjection().fromLatLngToPoint(a)}d="FAILURE"==a.analyticAttributes.machineStatus?new google.maps.MarkerImage("../../assets/images/redMapDot.png",null,null,null,new google.maps.Size(35,35)):"PREDICTING_FAILURE"==a.analyticAttributes.machineStatus?new google.maps.MarkerImage("../../assets/images/yellowMapDot.png",null,null,null,new google.maps.Size(35,35)):"UNDERGOING_MAINTENANCE"==a.analyticAttributes.machineStatus?new google.maps.MarkerImage("../../assets/images/blueMapDot.png",null,null,null,new google.maps.Size(35,35)):"NO_DATA"==a.analyticAttributes.machineStatus?new google.maps.MarkerImage("../../assets/images/orangeMapDot.png",null,null,null,new google.maps.Size(35,35)):"PERFORMING_OPTIMALLY"==a.analyticAttributes.machineStatus?new google.maps.MarkerImage("../../assets/images/greenMapDot.png",null,null,null,new google.maps.Size(35,35)):new google.maps.MarkerImage("../../assets/images/dashboard.png",null,null,null,new google.maps.Size(35,35)),c=new google.maps.Marker({position:new google.maps.LatLng(a.latitude,a.longitude),map:h,icon:d}),i.push(c);var g="<div class='contentWindow col-xs-12 row'><h2>"+a.manufacturer+"</h2><div class='col-xs-12 '><div class='machineModelTitle titleSec col-xs-12'>Machine Model</div><div class='machineModelBody infSec col-xs-12'> "+a.modelName+"</div></div><div class='col-xs-12'><div class='avgPowerConTitle titleSec col-xs-12'>Average Power Consumption</div><div class='avgPowerConBody infSec col-xs-12'> "+a.analyticAttributes.averagePowerConsumption+"</div></div><div class='col-xs-12'><div class='effLevelTitle titleSec col-xs-12'>Efficiency Level</div><div class='effLevelBody infSec col-xs-12'>"+a.analyticAttributes.machineEfficiencyLevel+"</div></div></div>",j=new google.maps.InfoWindow({disableAutoPan:!0});google.maps.event.addListener(c,"mouseover",function(a,b,c){return function(){c.setOptions({pixelOffset:e(h,a)}),c.setContent(b),c.open(h,a)}}(c,g,j)),c.addListener("mouseout",function(){j.close()}),google.maps.event.addListener(j,"domready",function(){var a=$(".gm-style-iw");a.css("margin-top","10px");var b=$(".contentWindow"),c=b.parent();c.css("overflow","hidden"),console.log("contentWindowParent"+c);var d=a.prev();d.children(":nth-child(2)").css({display:"none"}),d.children(":nth-child(4)").css({display:"none"}),d.children(":nth-child(1)").attr("style",function(a,b){return b+"left: 76px !important;"}),d.children(":nth-child(1)").css("display","none"),d.children(":nth-child(3)").attr("style",function(a,b){return b+"left: 76px !important;"}),d.children(":nth-child(3)").css("display","none"),d.children(":nth-child(3)").find("div").children().css({"box-shadow":"rgba(72, 181, 233, 0.6) 0px 1px 6px","z-index":"1"});var e=a.next();e.css({opacity:"0",right:"38px",top:"3px","border-radius":"13px"}),$(".iw-content").height()<140&&$(".iw-bottom-gradient").css({display:"none"}),e.mouseout(function(){$(this).css({opacity:"1"})})}),google.maps.event.addListener(h,"click",function(){j.close()})})}function f(a){for(var b=0;b<i.length;b++)i[b].setMap(a)}function g(a){var b,c;c="MAINTENANCE"==a.status?new google.maps.MarkerImage("../../assets/images/blueMapDot.png",null,null,null,new google.maps.Size(35,35)):"FAILURE"==a.status?new google.maps.MarkerImage("../../assets/images/redMapDot.png",null,null,null,new google.maps.Size(35,35)):"PREDICTING_FAILURE"==a.status?new google.maps.MarkerImage("../../assets/images/yellowMapDot.png",null,null,null,new google.maps.Size(35,35)):"NO_DATA"==a.status?new google.maps.MarkerImage("../../assets/images/orangeMapDot.png",null,null,null,new google.maps.Size(35,35)):new google.maps.MarkerImage("../../assets/images/greenMapDot.png",null,null,null,new google.maps.Size(35,35)),b=new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lon),map:h,icon:c}),h.setCenter(new google.maps.LatLng(a.lat,a.lon)),h.setZoom(6),i.push(b)}var h,i=[];return{
createOutdoorMap:c,createMachineMarkers:e,createAssetMachineMarkers:g}}),app.service("notificationDashboardService",function(a,b){function c(){return a({method:"get",url:"https://timeseries-test1.run.aws-usw02-pr.ice.predix.io/getNotificationsByCriteria"}).then(e,d)}function d(a){var c="";return angular.isObject(a.data)&&a.data.message||(c=b.reject("An unknown error occurred.")),0===c.length&&(c=b.reject(a.data.message)),c}function e(a){return console.log("response"+a),console.log(a),a.data}return{getNotificationData:c}});